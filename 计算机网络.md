第一章

## 一、因特网概述

### 1. 网络、互连网、因特网

> 1. 网络
>
>    * 含义：
>      * ==网络是由若干结点和连接这些结点的链路所组成的==
>      * 图示：
>        * ![image-20210922142603115](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221426192.png)
>
> 2. 互连网
>
>    * 含义：
>      * 多个网络通过路由器互连起来形成互连网
>      * 图例
>        * ![image-20210922142815210](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221428284.png)
>
> 3. 因特网（互联网）
>
>    * 含义：
>      * 世界上最大的互连网
>
> 4. internet与Internet的区别
>
>    ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221432278.png)



### 2.因特网服务提供者ISP

> 理解：提供网络服务的运营商
>
> 图例：
>
> ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221436778.png)
>
> 基于ISP的三层结构的因特网
>
> ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221436687.png)

### 3. 因特网的组成

> 1. 边缘部分：
>
>    边缘部分由所有连接在因特网上的主机组成。这部分是用户直接使用的，用来进行通信（传送数据、音频或视频）和资源共享
>
> 2. 核心部分：
>
>    核心部分由大量网络和连接这些网络的路由器组成。这部分是为边缘部分提供服务的（提供连通性和交换）
>
> 3. 图例：
>
>    ![image-20210922143933623](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221439702.png)

## 二、三种交换方式

### 1. 电路交换

> ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221442271.png)

### 2. 报文交换

> * 报文交换和分组交换差不多
>
> * ==报文交换是传输的整个报文==

### 3. 分组交换

> ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221442136.png)

### 4. 三者的对比

> ![Image](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109221443835.png)

---

## 三、计算机网络的定义和分类

> 定义：
>
> ​	计算机网络是一些互相连接的、自治的计算机的集合
>
> 特点：
>
> 1. 互连
>
>    计算机之间可以通过有线或无线的方式进行数据通信
>
> 2. 自治
>
>    指独立的计算机，有自己的硬件和软件，可以单独运行使用。
>
> 3. 集合
>
>    至少需要两台计算机
>
> 分类：
>
> ![image-20210923232754471](https://gitee.com/steadyHeart/drawingBed/raw/master//photos/202109232328662.png)

---

## 四、计算机网络的性能指标

### 1.影响因素

#### 1.1 速率

* 比特：
  * 厂家生产的硬盘容量和显示的不符：
    * ![image-20210924231647283](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20210924231647283.png)
    * ![image-20210924231701515](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20210924231701515.png)
* 速率：
  * 连接在计算机网络上的主机在数字信道上传送比特的速率，也称为比特率或数据率
* **数据量单位与数据率单位的对比**：
  * ![image-20210924231715210](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20210924231715210.png)
* 练习：
  * ![image-20210924231727667](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20210924231727667.png)
  * ![image-20210924231750436](C:/Users/李天帅/AppData/Roaming/Typora/typora-user-images/image-20210924231750436.png)

#### 1.2 带宽

* ![image-20210924231843685](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20210924231843685.png)

#### 1.3 吞吐量

* ![image-20211010200029520](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010200029520.png)

#### 1.4 时延

![image-20211010202031731](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010202031731.png)

**发送时延：**计算机发送数据需要时间（**数据全部发送出去的时间**）

​	发送速率：

![image-20211010202009312](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010202009312.png)

![image-20211010202518439](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010202518439.png)

**传播时延：**在链路上传播需要时间

![image-20211010202502727](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010202502727.png)

**处理时延：**路由器接收数据做存储转发需要的时间

​					由于处理时延不好计算，通常选择忽略



**习题：**

![image-20211010203147619](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211010203147619.png)

#### 1.5 时延带宽积

![image-20211106155244152](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106155244152.png)



#### 1.6 往返时间

![image-20211106155531963](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106155531963.png)

#### 1.7 利用率

![image-20211106155738818](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106155738818.png)



#### 1.8 丢包率

![image-20211106160036672](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106160036672.png)



## 五、计算机网络体系结构

> OSI体系结构被TCP/IP体系结构所替代
>
> 因为网络层采用的是ip协议（网际协议），所以叫为网际层

![image-20211106163331278](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106163331278.png)

**下图是用来供学习使用的**：

![image-20211106174921755](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106174921755.png)





![image-20211106165734116](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106165734116.png)



**每一层都是干啥的：**

### 1.物理层

![image-20211106172717016](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106172717016.png)



### 2.链路层

![image-20211106173534144](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106173534144.png)



### 3.网络层![image-20211106174126071](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106174126071.png)



### 4.运输层

![image-20211106174408332](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106174408332.png)



### 5.应用层

![image-20211106174553401](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106174553401.png)



### 6.总结

![image-20211106174802936](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211106174802936.png)



### 7.主机进程与服务器进程之间的通信

> 浏览器遵循http规则，发送请求报文包在运输层、网络层、数据链路层、物理层进行层层封装，之后通过路由器存储转发，之后到服务器层层拆分解析，服务器收到请求并作出响应



![image-20211107182833080](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211107182833080.png)



### 8.体系结构中的常用术语

#### 8.1	实体

> 任何可发送或接受信息的硬件或软件进程



**对等实体：**

> 收发双方相同层次中的实体



![image-20211107192736407](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211107192736407.png)



#### 8.2	协议

> 控制两个对等实体进行逻辑通信（逻辑通信是不存在的，这里说逻辑通信是为了忽略其他层的协议）的规则集合



![image-20211107193236519](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211107193236519.png)



#### 8.3	服务

![image-20211108193839724](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211108193839724.png)

![image-20211108193937267](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211108193937267.png)

![image-20211108194328967](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211108194328967.png)



## 六、练习题



![image-20211108210620473](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211108210620473.png)

![image-20211108211327658](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211108211327658.png)





# 第二章	物理层



> 目的：为了解决在各种传输媒体上传输比特0和1的问题
>
> 注意：传输媒体是不属于物理层的

![image-20211109141320326](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109141320326.png)



## 1. 传输媒体

1.1	导引型传输媒体

> 电磁波被导引沿着固体媒体传播
>
> 传输媒体：
>
> 1. 同轴电缆
> 2. 双绞线
> 3. 光纤
> 4. 电力线

1.2	非导引型传输媒体

> 空间是自由的，没有固体媒体限制
>
> 传输媒体：
>
> 1. 无线电波
> 2. 微波
> 3. 红外线
> 4. 可见光



## 2.传输方式

![image-20211109154201061](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109154201061.png)



## 3.编码与调制



![image-20211109161550214](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109161550214.png)

**码元：**

![image-20211109161510650](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109161510650.png)



**编码：**

![image-20211109162220194](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109162220194.png)



![image-20211230224103940](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211230224103940.png)



**调制：**

![image-20211109162458634](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211109162458634.png)







## 4.信道的极限容量

![image-20211231134843142](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231134843142.png)



**奈氏准则**：

![image-20211231135705928](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231135705928.png)





**香农公式**：



![image-20211231140119693](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231140119693.png)



![image-20211231140646913](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231140646913.png)





**练习**：



![image-20211231140923490](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231140923490.png)





![image-20211231141222475](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231141222475.png)

![image-20211231142516406](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231142516406.png)



![image-20211231142718560](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231142718560.png)



![image-20211231143112368](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211231143112368.png)















# 第三章	数据链路层



> 研究数据链路层时，可以忽略其他层，假设是从一台主机的数据链路层到另一台主机的数据链路层的直接传输

![](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110162813532.png)



## 1.封装成帧



> 添加帧头和帧尾的过程叫做封装成帧
>
> 数据链路层对上层协议数据单元封装好后就叫帧



![image-20211110163529690](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110163529690.png)



![image-20211110171448323](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110171448323.png)



**帧头和帧尾的作用：**

> 可以起到帧定界的作用
>
> ​	例如：采用PPP帧的话，可以根据帧头和帧尾里的标志内容，给每个帧话边界，以此来得到每个帧
>
> ​		如果采用MAC帧的话，在物理层会给帧加上前导码，并且使每个帧的间隔为96比特时间
>
> ![image-20211110172322657](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110172322657.png)
>
> ![image-20211110172422940](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110172422940.png)



**透明传输：**

> ==对上层交付的传输数据加以限制，不让其出现帧定界符。==
>
> ​	**面向字节的物理链路限制方案**（字符填充）：在给物理层发送帧之前，先把帧扫描一遍，再有定界符的后面加上转义字符。
>
> 在另一台主机下的数据链路层它会把第一个帧的定界符当作开始，最后一个定界符为结束。中间的定界符就是数据
>
> ​	**面向比特的物理链路限制方案**（零比特填充）：扫描数据，把帧数据部分中的每个5个连续的比特1后面加上一个0。取数据把加的0剔除即可



## 2.差错检测



![image-20211110164409206](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110164409206.png)



**检错方法：**

![image-20211110213437281](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110213437281.png)

![image-20211110213224842](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211110213224842.png)



## 3.可靠传输

> 可靠传输：尽管误码是不能完全避免的，但若能实现发送方发送什么，接收方就能收到什么就称为可靠传输
>
> 可靠传输当遇到误码时，就需要采取其他措施，让接收方获取被丢弃的这个帧的正确副本
>
> 如果不是可靠传输的话，直接就把误码丢掉了



![image-20211111144807639](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211111144807639.png)

![image-20211111150110106](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211111150110106.png)



### 3.1可靠传输的传输机制



![image-20211212131348936](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212131348936.png)





#### 3.1.1	停止-等待协议SW



**只有在发送方接收到接收方发送的ACK，才发送下一个数据**

> 当接收方接收到发送方发送的数据后进行差错检测，如果没有问题则发送ACK告诉发送方数据没有问题你可以把之前数据删除
>
> 如果有问题则发送NAK告诉发送方数据在传输中出现了误码，让发送方进行重传
>
> **注意：发送方在发送数据后，数据不会马上删除会先缓存起来，只有接收方发送了ACK才可以删除**

![image-20211212132210333](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212132210333.png)





> 如果**接收方接收不到发送方的数据,就不会发送ACK/NAK**，因此当发送方发送数据后，**设置一个超时计时器**，**如果超过了重传时间，发送方还没收到ACK/NAK，则重发数据**



![image-20211212133005517](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212133005517.png)



**发送方数据需要编号：**

> ACK/NAK在传输时丢了，导致发送方超时重传，接收方怎么确认新获得数据和原来的数据是否重复。
>
> ![image-20211212133514980](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212133514980.png)





**确认方数据需要编号：**

> ACK到发送比较晚的情况

![image-20211212133956416](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212133956416.png)





##### 3.1.1.1	注意事项



![image-20211212134448930](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211212134448930.png)



**SW信道利用率低**





#### 3.1.2	回退N帧协议GBN

> 根据**发送窗口的大小可以连续发送对应数量的分组**，接收窗口值为1，所以只能一个一个接收，接收成功后就像后滑动。都接收完成之后，**会发送一个累计确认，代表这个n及n之前的分组都已成功接收**，此时发送窗口就可以整体向前滑动。
>
> 

![image-20211213170145572](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211213170145572.png)	

> **出现差错的情况：**
>
> 当你发送分组时出现了**误码**而接收方不能接收，那么**在这个分组之后的正确分组也不能接收**，因为接受窗口为1所以只能按序接收。所以出现**误码的分组和正确的分组都要重发**。
>
> 当你的Wt=8（发送窗口的长度时），如果接收方正确接收了，此时接受窗口为0，并发送累计确认ACK，但是ACK中途丢失了。导致重传计时器超时重传并重新发送，此时又接收了一次重复的数据

![image-20211213170241456](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211213170241456.png)





**总结：**

![image-20211213173510640](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211213173510640.png)



**GBN与SW的主要区别为：**

> GBN：只要在发送窗口的大小范围内，不需先等待接收方的ACK帧就可以发送多个数据分组

**练习：**

![image-20211213174051518](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211213174051518.png)





#### 3.1.3	选择重传协议SR



> 选择重传协议与回退N帧协议区别：
>
> 选择重传协议的**接收窗口是大于1的**，以**便接收方收下失序到达但无误码并且序号落在接收窗口内**的那些分组。
>
> 选择重传协议不支持累计确认

![image-20211214172353118](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214172353118.png)





![image-20211214174148457](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214174148457.png)





**练习：**

![image-20211214174519931](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214174519931.png)

















## 4. 点对点协议ppp

![image-20211111152508465](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211111152508465.png)



### 4.1 PPP帧格式

![image-20211111152930922](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211111152930922.png)



### 4.2 实现透明传输

![image-20211111153505966](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211111153505966.png)



**面向字节的异步链路实现透明传输：**



![img](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/%5BWI(GCGJIAFZZU6D3AC%7D2)H.png)





**面向比特的同步链路实现透明传输：**

![img](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/01G3P~%604_VAXQUN_QMOATAU.png)



### 4.3 差错检测

![img](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/9YSQVBX9A71O@W6%]B5JRRH.png)



### 4.4	工作状态

![img](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/XAY10CX7C1N%7D051~PWAYME8.png)



## 5.	媒体接入控制



![img](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/IXNFP`SO6PD4V1_19BPS%XL.png)



![image-20211113160551210](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113160551210.png)



### 5.1	频分复用（FDM）

> A、B、C输入到复用器上，复用器将每一个信号调制到不同频率的载波上，接收端由相应的分用器通过滤波将各路信号分开
>
> 隔离频带的目的是：防止子信道间造成相互干扰

![image-20211113161135745](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113161135745.png)





### 5.2	时分复用（TDM）

> 将传输线路的带宽资源按时隙分配给不同的用户，每个用户只在所分配的时隙里使用线路进行数据的传输

![image-20211113161908952](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113161908952.png)



### 5.3	波分复用（WDM）

> 和频分复用差不多

![image-20211113162419857](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113162419857.png)



### 5.4	码分复用（CDM）

![image-20211113163025047](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113163025047.png)

![image-20211113164340720](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113164340720.png)



### 5.5	动态接入控制

#### 	5.5.1	随机接入

​	

##### 5.5.1.1	CSMA/CD

> 总线局域网使用协议

![image-20211121150151224](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121150151224.png)



###### 5.5.1.1.1	过程

![image-20211121150607212](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121150607212.png)

###### 5.5.1.1.2	争用期



![image-20211121151414222](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121151414222.png)



###### 5.1.1.1.3	最小帧长

![image-20211121153425050](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121153425050.png)



###### 5.1.1.1.4	最大帧长

![image-20211121154144050](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121154144050.png)





###### 5.1.1.1.5	截断二进制指数退避算法

![image-20211121154245649](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121154245649.png)



###### 5.1.1.1.6	帧的接收流程

![image-20211121155142137](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121155142137.png)



###### 5.1.1.1.7	练习

![image-20211121155755816](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121155755816.png)



##### 5.5.1.2		CSMA/CA

> 无线局域网使用协议

![image-20211121160958532](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121160958532.png)



![image-20211121163127520](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121163127520.png)



## 6.MAC地址、IP地址、ARP协议



### 6.1	MAC地址

> 在一段链路上传输，为了标识不同主机的接口就有了MAC地址

![image-20211121165222743](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121165222743.png)

![image-20211121165525810](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121165525810.png)



![image-20211121165945858](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121165945858.png)



#### 6.1.1	格式

![image-20211121170444962](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121170444962.png)

![image-20211121171356884](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121171356884.png)



#### 6.1.2	发送顺序

![image-20211121171511478](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121171511478.png)

---

#### 6.1.3	单播MAC地址

![image-20211121172701843](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121172701843.png)



#### 6.1.4	广播MAC地址

> 一台主机发送广播帧时，链路上的主机都会接受该帧

![image-20211121172800637](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121172800637.png)



#### 6.1.5	多播MAC地址

> 会有多个主机接受

![image-20211121172957050](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121172957050.png)

![image-20211121173058366](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121173058366.png)



### 6.2	IP地址

![image-20211121175028964](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121175028964.png)



#### 6.2.1	数据包转发过程中IP、MAC地址的变化

![image-20211121175800668](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121175800668.png)

![image-20211121180143603](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121180143603.png)



#### 6.2.2	练习

![image-20211121180654260](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211121180654260.png)



### 6.3	ARP协议



**问题引入：**

![image-20211122192852881](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122192852881.png)



**解决方法：**

> 主机B封装MAC帧时，在自己的ARP高速缓存表中查看C的IP地址和其对应的MAC地址，结果没找到。
>
> 主机B这时会构建==ARP请求报文==封装在MAC帧中，给这条链路上的主机发送。每个主机进行解析，如果是对应的主机C那么，C会把B的ip地址和MAC地址记录在自己的ARP高速缓存表中。然后把ARP响应报文发送给主机B告诉C的MAC地址



**1.查看ARP高速缓存表**

![image-20211122192930912](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122192930912.png)





**2.表中没有则发送含有ARP请求报文的帧**

![image-20211122193647138](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122193647138.png)



**3.发送响应含有ARP响应报文的帧**

![image-20211122193948510](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122193948510.png)



**4.记录到ARP高速缓存表**

![image-20211122194046647](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122194046647.png)



**类型：**

> IP地址与MAC地址的对应关系不是一成不变的

![image-20211122194627734](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122194627734.png)





**总结：**

![image-20211122195606015](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122195606015.png)



## 7.集线器



![image-20211122200838981](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122200838981.png)



**以太网交换机：**

![image-20211122205237182](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122205237182.png)



**对比：**

![image-20211122202928456](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211122202928456.png)



## 8.以太网交换机



![image-20211123212601152](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123212601152.png)



### 8.1	自学习和转发帧



**以主机A给B发送帧为例讲述自学习过程：**



**初始状态：**

![image-20211130200939562](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130200939562.png)



**A给B发完帧后的状态：**

> 在交换表中登记信息，就叫自学习
>
> 泛洪：交换表没有对应目的主机的记录，交换机只能把该帧发给**除了把帧发送进来的接口之外的其他接口**

![image-20211130200749389](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130200749389.png)



**主机B给主机A发送帧：**

![image-20211130202245687](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130202245687.png)



**主机E给主机A发送帧：**

![image-20211130202541519](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130202541519.png)



**主机G给主机A发送帧：**

> ​	==A与G通过集线器连入到接口1，这说明A、G、接口1在同一总线上，G发送帧时，会发给A、接口1==
>
> ​	主机G通过集线器把帧发送给A，目的地址相同，所以A接收该帧。
>
> ​	主机G通过接口1，这时交换机1开始自学习，登记G的信息及接口，之后再交换表中查找目的主机的地址（A），找到后发现是接口1，因为就是从接口1进来的，所以不能从接口1出去，因此丢弃该帧。交换机2也不会收到该帧（因为已经找到了）

![image-20211130203247146](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130203247146.png)





**全部添加完成时：**

![image-20211130204355781](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130204355781.png)





### 8.2	练习

![image-20211130205443140](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130205443140.png)





![image-20211130205719479](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130205719479.png)



![image-20211130210259751](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130210259751.png)



### 8.3	以太网交换机的生成树协议



**问题引入：**

![image-20211130210729262](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130210729262.png)

> 两个交换机之间的链路发送故障，那么数据就无法发送

![image-20211130210558397](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130210558397.png)







**添加冗余链路：**

![image-20211130212008358](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130212008358.png)



**缺点：**

![image-20211130211848250](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130211848250.png)





**以太网交换机的生成树协议STP：**

![image-20211130212712803](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211130212712803.png)







## 9.VLAN



### 9.1 概述



**前提引入：**

> 当交换式以太网互连的主机非常多时，发送广播帧，就像是风暴一样



![image-20211205165803813](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211205165803813.png)



### 9.2	解决方法



#### 9.2.1 分割广播域

> ​	使用路由器分割广播域（**路由器默认不会转发广播数据包**），缺点是路由器成本太高。
>
> **使用路由器之后：**
>
> ![image-20211205170254189](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211205170254189.png)



#### 9.2.2	虚拟局域网技术

> 同一个vlan可以广播通信

![image-20211205171009243](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211205171009243.png)



**实现机制：**

##### 9.2.2.1	IEEE 802.1Q帧

![image-20211206154503580](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206154503580.png)



##### 9.2.2.2	交换机的端口类型

![image-20211206154942597](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206154942597.png)



> 交换机首次通电时，默认配置各端口属于vlan1，所以access端口的pvid等于1
>
> 接收与发送是相对于交换机与外部而言的

###### 9.2.2.2.1	access

![image-20211206160142220](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206160142220.png)



![image-20211206160629223](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206160629223.png)



###### 9.2.2.2.2	trunk

![image-20211206162006164](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206162006164.png)



练习：

![image-20211206162651988](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206162651988.png)





###### 9.2.2.2.3	hybrid

> 华为交换机所特有

![image-20211206163418089](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206163418089.png)

![image-20211206163619366](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211206163619366.png)





















# 第四章	网络层

> 网络层的主要任务是实现网络互连，进而实现数据包在各网络之间的传输
>
> ![image-20211113195410026](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113195410026.png)
>
> **注意：有时为了简单，就不会画网络（那层云）**
>
> 
>
> **这一章要面对的问题：**
>
> ![image-20211113200124966](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113200124966.png)



## 1.网络层提供的两种服务

### 	1.1	面向连接的虚电路服务

![image-20211113204921401](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113204921401.png)



![image-20211113204941260](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113204941260.png)



### 1.2	无连接的数据报服务

> TCP/IP	网络层采用的就是无连接的数据报服务

![image-20211113205316121](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113205316121.png)



### 1.3	两者服务的比较

![image-20211113205549476](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113205549476.png)





## 2.IPV4



**IPV4的概念：**

![image-20211113205917249](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113205917249.png)



**经历阶段：**

![image-20211113210022640](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113210022640.png)



**IPV4地址的表示方法：**

![image-20211113210932757](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113210932757.png)

![image-20211113210911999](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211113210911999.png)



### 2.1	分类编址

![image-20211114162209429](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114162209429.png)



#### 2.1.1	分析A类地址

![image-20211114164207217](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114164207217.png)



#### 2.1.2	分析B类地址

![image-20211114165156073](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114165156073.png)



#### 2.1.3	分析C类地址

![image-20211114165659697](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114165659697.png)



#### 2.1.4	练习

![image-20211114170330572](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114170330572.png)



![image-20211114171838448](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114171838448.png)



**![image-20211114173640402](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114173640402.png)**





### **2.2	划分子网**

>  背景：
>
> 1.最开始的状态
>
> ![image-20211114194715234](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114194715234.png)
>
> 2.随着发展，该网络可能会划出多个独立的网络，这样就得给每个网络申请网络号，如下，这样会有很多缺点
>
> ![image-20211114194938585](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114194938585.png)
>
> 3.引入子网的概念
>
> ![image-20211114195733122](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114195733122.png)
>
> 4.借助子网掩码划分子网
>
> ![image-20211114195929919](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114195929919.png)



#### 2.2.1	具体划分细节

![image-20211114200734334](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114200734334.png)



**图解：**

![image-20211114201340401](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114201340401.png)



**练习：**

![image-20211114202923442](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114202923442.png)



![image-20211114204827729](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114204827729.png)





#### 2.2.2	默认子网掩码

![image-20211114205208457](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114205208457.png)



### 2.3	无分类编址

> 背景：
>
> ![image-20211114205828442](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114205828442.png)



**介绍：**

![image-20211114205734300](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114205734300.png)



**例题：**

![image-20211114210216232](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114210216232.png)



**练习：**

![image-20211114211141760](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114211141760.png)



![image-20211114212230848](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114212230848.png)



#### 2.3.1	路由聚合

> 需要加R1的5条记录通告给R2就得在路由表上记录5次，将这5次记录聚合（**减少对路由表的占用**）成一条就是路由聚合

![image-20211114211927212](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114211927212.png)

**练习：**

![image-20211114212722494](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211114212722494.png)





#### 2.4		IPV4地址的应用规划

##### ![image-20211119193447297](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119193447297.png)



##### 2.4.1	定长的子网掩码（FLSM)

![image-20211119194117342](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119194117342.png)![image-20211119194940785](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119194940785.png)

![image-20211119195208572](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119195208572.png)



##### 2.4.2	变长的子网掩码（VLSM）

![image-20211119195746368](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119195746368.png)![image-20211119201527045](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119201527045.png)

![image-20211119201553911](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211119201553911.png)





## 3.	IP数据报的发送和转发过程

> IP数据报的发送和转发过程包含以下两部分
>
> ​	1.主机发送IP数据报
>
> ​	2.路由器转发IP数据报



**源主机如何知道目的主机是否与自己在同一网络中?**

> ​	源主机与自己的子网掩码做与运算取得自己的网络地址，既然是要发给，目的地址那么肯定知道它的ip地址，用它的ip地址与源主机的子网掩码做与运算，得到的网络号与源主机的网络号所比较



![image-20211123213646361](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123213646361.png)



**网关：**

> 本网络默认指定的路由器就是网关

![image-20211123213946287](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123213946287.png)



### 3.1	流程

> 源主机对不同的网络的目的主机发送IP数据报（A-D）：
>
> ​	源主机发送IP数据报给交换机，交换机再发送给路由器，路由器会检查IP数据报首部是否出错，出错直接丢弃并告知源主机。没有出错就进行转发。根据IP数据报的目的地址在路由表中查找匹配的条目，若找到，则转发给条目中指示的下一跳；若找不到，则丢弃该IP数据报并通过源主机





![image-20211123214200769](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123214200769.png)

![image-20211123215308256](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123215308256.png)![image-20211123222130157](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123222130157.png)





**总结**：

![image-20211123225222328](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123225222328.png)





**路由器不对广播IP数据报进行转发：**

![image-20211123222634094](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123222634094.png)



### 3.2	练习

![image-20211123224004880](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123224004880.png)

![image-20211123224253940](C:/Users/李天帅/AppData/Roaming/Typora/typora-user-images/image-20211123224253940.png)

![image-20211123225044852](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211123225044852.png)





## 4.静态路由配置及其可能产生的环路问题



**静态路由配置：**

> ​	指用户或网络管理员使用路由器的相关命令给路由器人工配置路由表。



![image-20211124081700454](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124081700454.png)





**使用静态配置可能出现以下导致产生路由环路的错误：**

> 1. 配置错误
> 2. 聚合了不存在的网络
> 3. 网络故障





### 4.1	静态路由配置



![image-20211124083121019](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124083121019.png)





#### 4.1.1	默认路由



> ​	对于具有相同下一跳而目的网络不同的路由条目可以采用默认路由条目来替代
>
> ![image-20211124092246683](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124092246683.png)



![image-20211124083928540](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124083928540.png)



#### 4.1.2	特定主机路由

> ​	路由表的条目可以是特定主机的路由条目
>
> ![image-20211124092231644](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124092231644.png)

![image-20211124084709883](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124084709883.png)





### 4.2	路由环路



1.**配置错误**：

![image-20211124085635576](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124085635576.png)





2.**聚合了不存在的网络**：



**聚合路由：**

![image-20211124085901660](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124085901660.png)



![image-20211124090813994](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124090813994.png)



**解决方案**：

> 192.168.3.0/24不存在的网络在路由表中有两条匹配的条目，根据最长前缀匹配原则，转发给192.168.3.0/24（黑洞路由）

![image-20211124091009563](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124091009563.png)



**3.网络故障：**

![image-20211124091554718](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124091554718.png)

![image-20211124091750467](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124091750467.png)

**解决方案：**

> 添加黑洞路由

![image-20211124091900507](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124091900507.png)



**故障消除：**

![image-20211124092057839](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124092057839.png)





## 5.路由选择协议



**静态路由选择与动态路由选择的对比：**

![image-20211124162822026](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124162822026.png)



**因特网采用的路由选择协议的特点：**

![image-20211124163135184](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124163135184.png)



分层次：

> ​	自治系统内的路由选择叫做域内路由选择，自治系统外的路由选择叫做域间路由选择。
>
> 注意：内部网关协议IGP和外部网关协议EGP不是具体的协议，只是协议分类的名称

### ![image-20211124163722894](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124163722894.png)



### 5.1	协议分类

![image-20211124164817725](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124164817725.png)



#### 5.1.1	路由信息协议RIP



##### 5.1.1.2	相关概念

![image-20211207150753197](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207150753197.png)



![image-20211207151040633](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207151040633.png)





![image-20211207151056767](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207151056767.png)



![image-20211207151222887](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207151222887.png)





##### 5.1.1.3	基本过程

![image-20211207151826177](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207151826177.png)



![image-20211207151922423](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207151922423.png)



**RIP的路由条目的更新规则：**

> 当C的RIP更新报文的发送周期到了的时候，C会发送RIP更新报文（简单的理解为C的路由表信息）给D，告诉D,C可以去哪，因为C是D的邻居路由，D可以通过C，距离得加1



![image-20211207152307407](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207152307407.png)

![image-20211207153348005](C:/Users/李天帅/AppData/Roaming/Typora/typora-user-images/image-20211207153348005.png)





**练习：**

![image-20211207153737213](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207153737213.png)



![image-20211207153750112](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207153750112.png)





![image-20211207154142331](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207154142331.png)



##### 5.1.1.4	坏消息传播得慢问题

![image-20211207155337116](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207155337116.png)



![image-20211207155434289](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207155434289.png)



![image-20211207155929190](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207155929190.png)



**练习：**

![image-20211207160203908](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207160203908.png)





![image-20211207160311881](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207160311881.png)



![image-20211207160554302](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207160554302.png)



![image-20211207160648957](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207160648957.png)



#### 5.1.2	开放最短路径优先OSPF



##### 5.1.2.1	相关概念

![image-20211207162642084](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207162642084.png)



![image-20211207163018359](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207163018359.png)





![image-20211207163503128](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207163503128.png)



![image-20211207163945399](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207163945399.png)



![image-20211207164328183](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207164328183.png)



##### 5.1.2.2	原理

> 基于链路状态数据库得出带权有向图，根据相关算法求出各自到达其他路由器的最短路径，构建各自路由表

![image-20211207164836536](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207164836536.png)



##### 5.1.2.3	五种分组

![image-20211207165431240](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207165431240.png)



##### 5.1.2.4	工作流程



![image-20211207170129261](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207170129261.png)





##### 5.1.2.5	OSPF在多点接入网络中路由器邻居关系关系的建立



![image-20211207170526137](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207170526137.png)



##### 5.1.2.6	划分

![image-20211207171049897](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207171049897.png)











#### 5.1.3	边界网关协议BGP



> 在不同的自治系统内，度量路由的代价可能不同，所以自治系统之间的路由选择使用代价作为度量来寻找最佳路由是不行的

![image-20211207172844122](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207172844122.png)



![image-20211207173121775](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207173121775.png)

![image-20211207173952467](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207173952467.png)





##### 5.1.3.1	工作原理

![image-20211207174554846](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207174554846.png)



![image-20211207174903501](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207174903501.png)



![image-20211207175141041](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207175141041.png)





##### 5.1.3.2	BGP的4种报文



![image-20211207175726298](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207175726298.png)



##### 5.1.3.3	练习

![image-20211207180028425](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207180028425.png)



![image-20211207180232933](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207180232933.png)









### 5.2	路由器结构

> 路由器的基本结构主要分为**路由选择部分**和**分组转发部分**
>
> 路由器选择处理机通过具体的路由选择协议周期性的与其他的路由器进行路由信息的交互来更新路由表

![image-20211124165108776](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124165108776.png)





### 5.3	IPV4数据报的首部格式

![image-20211124190633125](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124190633125.png)

![image-20211124190701031](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124190701031.png)



![image-20211124191219193](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124191219193.png)



![image-20211124191311044](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124191311044.png)



![image-20211124192403496](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124192403496.png)

![image-20211124192808250](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124192808250.png)



**分片举例：**

![image-20211124194214492](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124194214492.png)



**将分片2进行再分片：**

![image-20211124194558663](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124194558663.png)



![image-20211124194929701](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124194929701.png)





![image-20211124200003621](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124200003621.png)



![image-20211124200218255](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124200218255.png)



![image-20211124200554283](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124200554283.png)

![image-20211124200641985](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124200641985.png)



#### 5.3.1	练习

![image-20211124201921303](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124201921303.png)



![image-20211124202027015](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124202027015.png)





### 5.4	网际控制报文协议ICMP

![image-20211124203558336](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124203558336.png)

#### 5.4.1	终点不可达

![image-20211124204031198](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124204031198.png)



#### 5.4.2	源点抑制

![image-20211124204325964](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124204325964.png)

![image-20211124204436367](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124204436367.png)

#### 5.4.3	时间超过

![image-20211124204629642](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124204629642.png)

![image-20211124204752758](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124204752758.png)



#### 5.4.4	参数问题

![image-20211124205050908](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124205050908.png)



#### 5.4.5	改变路由（重定向）

![image-20211124205441169](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124205441169.png)



#### 5.4.6	以下情况不发生ICMP差错报文

![image-20211124205845214](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124205845214.png)





#### 5.4.7	ICMP询问报文

![image-20211124211639381](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124211639381.png)



##### 5.4.7.1	应用



**1.分组间探测（PING）**

![image-20211124211914262](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124211914262.png)



**2.跟踪路由**

![image-20211124212417060](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124212417060.png)



**举例：**

![image-20211124213159150](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124213159150.png)



**原理：**

![image-20211124213041724](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124213041724.png)

![image-20211124212610534](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124212610534.png)

![image-20211124212748200](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124212748200.png)

![image-20211124212852801](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124212852801.png)

![image-20211124212915318](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124212915318.png)

![image-20211124213013903](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124213013903.png)



##### 5.4.7.2	练习

![image-20211124211137411](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211124211137411.png)





### 5.5	虚拟专用网VPN与网络地址转换NAT



#### 5.5.1	虚拟专用网VPN

![image-20211207200139715](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207200139715.png)



> 私有地址的主机只能对私有主机进行通信，不能与因特网上的主机进行通信，且因特网上的路由器不会进行转发

> 内部主机把IP数据报（**源地址为内部主机，目的地址为接收方的内部主机**）发送给路由器，路由器**将IP数据报进行加密**（确保了数据报的安全）并**添加首部**（**源地址为路由器IP地址，接收方为路由器IP地址**）封装成在因特网上发送的外部数据报。
>
> 接收方路由器去掉首部，并将IP数据报进行解密，恢复成最开始的IP数据报，根据目的地址，发送给对应的内部主机。

> 因为这种方式就跟直接在内部通信一样，而中间就像一个隧道所以这种技术也被称为IP隧道技术

![image-20211207201036803](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207201036803.png)



![image-20211207204558436](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211207204558436.png)





#### 5.5.2	网络地址转换NAT



![image-20211208162205908](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208162205908.png)



**专用网主机将IP数据报发送给因特网主机：**

![image-20211208162950189](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208162950189.png)





**因特网主机发送IP数据报给专用网主机：**

![image-20211208163122853](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208163122853.png)



> NAT路由器具有N个全球IP地址，那么至多只能有N个内网主机能够同时和因特网上的主机通信

![image-20211208163429153](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208163429153.png)



![image-20211208164222053](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208164222053.png)



![image-20211208164534374](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208164534374.png)





#### 5.5.3	网络地址与端口号转换NAPT

![image-20211208163932181](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211208163932181.png)





---



# 第五章	运输层



## 5.1	运输层相关概述



![image-20211209095716167](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211209095716167.png)



### 5.1.1	端口号概念

![image-20211209101106002](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211209101106002.png)





**复用与分用**

> 复用就是对上层信息进行封装，分用就是将封装的信息拆开

![image-20211209101615234](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211209101615234.png)



**常见端口号**：

![image-20211209101813754](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211209101813754.png)





### 5.1.2	UDP和TCP的对比

> 1. **是否需要建立连接**
>
>    1. UDP,不需要建立连接，可以随时发送数据
>    2. TCP需要建立连接（三次握手），和断开连接（4次挥手）
>
>
> 2. **是否仅支持单播**
>
>
>    1. UDP可以进行单播、多播、广播
>
>    2. TCP仅支持单播
>
>       
>
> 3. **是否面向字节流**
>
>
>    1. UDP是面向应用报文的
>
>    2. TCP是面向字节流的
>
>       ![image-20211210132040928](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210132040928.png)
>
> 
>
> 4. **是否是可靠传输**
>
>
>    1.   UDP是无连接的不可靠的传输（出现了误码，丢失后发送方也不管）
>    2.   TCP是有连接的可靠的传输
>
>    ![image-20211210132708403](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210132708403.png)
>
> 
>
> 5. **首部的不同**
>
>
>    1.   UDP首部较为简单
>    2.   TCP首部较为复杂
>
>    ![image-20211210133130755](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210133130755.png)
>





## 5.2	TCP



### 5.2.1	TCP的流量控制

![image-20211210133959326](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210133959326.png)







![image-20211210140259502](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210140259502.png)

> ​	（**发送窗口会根据接收窗口的变化而变化**）刚开始的时候，接收方将接收窗口限制为400，因此发送方将自己的发送窗口也设为400，发送方开始100、100的发送字节数据，当发送到201-300号字节数据时丢失了，这时会**启动重传计时器进行计时**，这时接收方对之前接收的数据进行了累计确认，告诉发送方201之前的成功接收，将接收窗口调整为300，发送窗口滑动到201-500（因为201-300没有确认），继续100、100的发。到达了接收窗口的范围就不能再发了，这时候重传计时器超时了，就重传201-300。接收方继续进行累计确认，确认数据是否收到，并调整接收窗口。	到了601后，接收方调整接收窗口为0，因此发送方就一直等待非零窗口通知，接收方此时调整接收窗口为300，但发送方没收到，此时就会出现死锁局面。**解决方法：**TCP会为每个连接设有一个持续计时器，当TCP连接的一方收到零窗口通知，就启动持续计时器，若持续计时器超时就发送一个零窗口探测报文仅携带一字节数据，对方收到这个报文段给出自己的接收窗口值，若为0，继续重新启动持续计时器计时。不是0就打破了死锁局面

![image-20211210140231815](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210140231815.png)

![image-20211210142515845](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210142515845.png)



**练习：**

![image-20211210143722732](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211210143722732.png)



### 5.2.2	TCP拥塞控制

![image-20211211115027604](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211115027604.png)![image-20211211115322498](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211115322498.png)

![image-20211211115358150](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211115358150.png)



**拥塞窗口：**

> 拥塞窗口设置为多大，就代表一次性可以发送多少数据报文段



**初始情况：**

![image-20211211134513369](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211134513369.png)





**报文段丢失、重传计时器超时：**

![image-20211211135135454](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211135135454.png)



![image-20211211135220121](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211135220121.png)



**确定新的慢开始门限值：**

![image-20211211135738613](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211135738613.png)



**总体：**

> ​	初始时设置慢开始门限值，拥塞窗口为1，**当拥塞窗口值小于门限值时，进行慢开始**，**当拥塞窗口值大于门限值时，就采取拥塞避免**。**当重传计时器超时**（可能是网络造成了拥塞），就将**慢开始门限值缩短为当前拥塞窗口的一半，并设置拥塞窗口为1**，再进行慢开始
>
> 慢开始：每经历过一个传输轮次拥塞窗口就进行指数增长
>
> 拥塞避免：每经历过一个传输轮次拥塞窗口就进行线性增长（+1操作）

![image-20211211141726869](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211141726869.png)

​	



**快重传：**

引入：

> 发送方发送M1，接收确认M1给发送方的同时发送方可以发送M2，当发送M3时，接收方没收到，自然不会发送确认。当发送方发送M4时，接收方收到后发现是未按序到达的报文段，之后就重复确认M2三次，之后就对M3立即重传

![image-20211211143119292](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211143119292.png)

![image-20211211145105630](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211145105630.png)





**快恢复：**

![image-20211211145719020](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211145719020.png)



**总体：**

![image-20211211145955370](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211145955370.png)



**练习：**

![image-20211211151559840](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211151559840.png)





### 5.2.3 	TCP超时重传的选择

> 超时重传时间应略大于往返时间，但是每一次往返时间有长有短

![image-20211211153928037](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211153928037.png)



**解决方法：**

> 利用每次测量得到的RTT样本，计算加权平均往返时间RTTs，通过RTTs再计算RTO

![image-20211211154434226](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211154434226.png)

![image-20211211154644246](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211154644246.png)

![image-20211211155236027](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211155236027.png)

![image-20211211155936641](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211211155936641.png)





### 5.2.4	TCP可靠传输的实现



> 接收方只对按序接收的最高序号进行确认（累计确认）
>
> 发送方窗口滑动：收到接收方的ACK帧
>
> 接收窗口滑动：收到按序发送的分组，**不按序分组进行接收但不滑动并且返回对按序接收的最高序号的确认**

![image-20211214190638526](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214190638526.png)

![image-20211214192934989](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214192934989.png)





**练习：**

![image-20211214193803571](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214193803571.png)







![image-20211214200055411](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211214200055411.png)





### 5.2.5	TCP的运算连接管理



![image-20211215160859924](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215160859924.png)





#### 5.2.5.1		TCP连接的建立



**主要解决的问题：**

![image-20211215163801119](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215163801119.png)





> TCP连接请求报文段SYN=1，表示不携带任何数据，但需要消耗一个序号。
>
> 正常只有ACK时就是普通的TCP确认报文段，如果携带数据则需要消耗序号，反之不消耗序号
>
> ack的值为上个报文段的seq+1是对收到的TCP报文段进行确认



> ​	刚开始TCP服务器和TCP客户端处于**关闭状态**，TCP服务器**首先创建传输控制块**（用来存储TCP连接中的一些重要信息）之后就进行**监听**，**被动的等待**客户端的连接请求（被动打开连接）。
>
> ​	TCP客户端首先也是创建传输控制块，然后**发送TCP连接请求报文段**并进入同步已发送状态，若TCP服务器接收请求就会**发送TCP连接请求确认报文段**并进入同步已接收状态，客户端接收后会发送一个普通的TCP确认报文段并进入连接已建立状态，TCP服务器接收到TCP确认报文段后也会进入连接已建立状态。之后就可以进行可靠的数据传输了



![image-20211215171627868](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215171627868.png)





**为什么不能是两报文握手？**

> TCP连接请求报文段在网络中滞留后，当TCP已经关闭连接后这个报文段才到，那么服务器以为客户端又来进行TCP连接（实际并没有），这样就会白白浪费服务器的资源

![image-20211215171336820](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215171336820.png)

**练习：**

![image-20211215163532216](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215163532216.png)





#### 5.2.5.2	TCP连接的释放



> TCP客户端/服务端都可以关闭TCP连接
>
> FIN=1,ACK=1表明这是一个TCP连接释放报文段，其seq=客户端已传送过的最后一个字节的序号+1（不携带数据也要消耗一个序号），ack=客户端已经接受过的最后一个字节的序号+1



> ​	TCP客户端发送**TCP连接释放报文段并进入终止等待1状态**，TCP服务端收到会**发送一个普通的TCP确认报文段**（ack=服务器已经接受过的最后一个字节的序号+1）并进入**关闭等待状态**，这时TCP服务器进程向高层应用通知TCP客户进程要与自己断开连接，**TCP客户进程到TCP服务进程这方向的连接就释放了**（这时处于半关闭状态），但是相反的方向还没有释放，这时TCP服务端还可以向TCP客户端发送数据。TCP客户端收到TCP确认报文段后就进入**终止等待2状态**，等待TCP服务器进程发出的TCP连接释放报文段。若使用TCP服务器进程的应用程序已经没有数据要发送了，应用程序就通知TCP服务器进程释放连接，此时TCP服务器进程发送TCP连接释放报文段并进入最后确认状态，TCP客户进程收到TCP连接释放报文段后发送普通的TCP确认报文段并进入时间等待状态，TCP服务器进程收到TCP确认报文段后就进入关闭状态，而TCP客户进程要等待2MSL才能进入关闭状态



<img src="https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211215224531510.png" alt="image-20211215224531510" style="zoom:50%;" />





**为什么需要等待2MSL？**

> 1. TCP客户端进程发送完最后一个TCP确认报文段后就进入关闭状态，万一这个报文段丢失了，那么TCP服务器没收到客户端的确认，这必定会发生超时重传，而且会持续下去无法进入关闭状态。
>
> 2. 等待2MSL也可以清空网络上的旧的TCP报文段

![image-20211217112814974](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217112814974.png)





**保活计时器**

![image-20211217113309675](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217113309675.png)





### 5.2.6	TCP首部格式



![image-20211217113818872](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217113818872.png)



**首部格式：**

![image-20211217113929029](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217113929029.png)



![image-20211217114857557](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217114857557.png)



![image-20211217114827776](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217114827776.png)



![image-20211217115030314](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217115030314.png)



![image-20211217115057465](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217115057465.png)



![image-20211217121414654](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217121414654.png)

![image-20211217121446015](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217121446015.png)

![image-20211217121829154](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217121829154.png)

![image-20211217122145918](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217122145918.png)

![image-20211217122411666](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217122411666.png)

![image-20211217122519946](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217122519946.png)



![image-20211217123040874](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217123040874.png)

![image-20211217123111108](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217123111108.png)

![image-20211217123525352](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217123525352.png)

![image-20211217124058729](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217124058729.png)

![image-20211217124112717](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211217124112717.png)





---



# 第六章	应用层





## 6.1	动态主机配置协议DHCP



**问题引入：**

> 主机中的IP地址、子网掩码、默认网关、DNS服务器可以手动配置。但当网络中有大量主机的时候，手动配置就显得乏力了，这就有了DHCP服务器



### 6.1.1	工作过程



> DHCP客户就是DHCP客户进程，DHCP服务器就是DHCP服务器进程

> ​	当启用主机的DHCP后，DHCP客户进程将会在网络中**广播发送DHCP发现报文**，源地址为0.0.0.0（因为现在主机还没有分配IP）。DHCP服务器收到后根据DHCP客户端的MAC地址查找自己的数据库看是否有针对该MAC地址的配置信息，如果有则使用这些配置信息来构建并发送DHCP提供报文，如果没有则采用默认配置信息来构建并发送DHCP提供报文。封装DHCP提供报文的IP数据报的源IP地址为DHCP服务器的IP地址，目的地址为广播地址（因为主机目前还没有配置IP地址，为了使主机收到只能发送广播）。DHCP客户端会根据DHCP提供报文中的事物ID来判断该报文是否是自己所请求的报文。
>
> ​	之后DHCP客户端向DHCP服务器发送DHCP请求报文（源地址仍为0.0.0.0，目的地址为广播地址）它得征得选择的DHCP服务器的同意，假设该DHCP客户端选择DHCP服务器1作为自己的DHCP服务器，并且该服务器同意，该服务器就会发送DHCP确认报文（源地址为DHCP服务器，目的地址为广播地址），DHCP客户端收到确认后就可以使用租用的IP地址了，再使用租用IP地址之前还要用ARP检测所分配的IP地址是否被其他主机占用，然后做相应决策。
>
> ​	当租用期过了一半时，DHCP客户端会向DHCP服务器发送DHCP请求报文来请求更新租用期（源IP地址为租用的地址，目的地址为DHCP服务器1），若DHCP服务器1同意则发回DHCP确认报文，这样DHCP客户端就得到了新的租用期。若DHCP服务器不同意则发送DHCP否认报文，这时DHCP客户必须立即停止使用之前租用的IP地址并重新发送DHCP发现报文来重新申请IP地址，若DHCP未响应则在租用期过了87.5%时，DHCP客户必须重新发送DHCP请求报文，若未响应则租用期到后必须停止使用租用的IP地址并重新发送DHCP发现报文来重新申请IP地址。DHCP客户可以随时提前终止DHCP服务器所提供的租用期，这时只需要向DHCP服务器发送DHCP释放报文段即可



![image-20211218172345104](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218172345104.png)

![image-20211218173049008](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218173049008.png)

![image-20211218173421241](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218173421241.png)





![image-20211218174456071](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218174456071.png)





### 6.1.2	DHCP中继代理



> 路由器是不能转发广播报文的。

![image-20211218174803827](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218174803827.png)



**为什么要使用DHCP中继代理？**

> 因为这样每个网络都会有DHCP服务器，DHCP服务器数量过多



> ​	要给该路由器配置DHCP服务器的IP地址并使之成为DHCP中继代理，当该路由器收到广播的DHCP发现报文后会将其单播转发给DHCP服务器

![image-20211218175113629](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218175113629.png)





## 6.2	域名系统DNS



> 域名的每一级从左到右级别一次增高
>
> ![image-20211218205138473](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218205138473.png)



![image-20211218211249280](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218211249280.png)



**域名服务器的种类：**

![image-20211218211320382](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218211320382.png)



**域名解析的过程：**

1. 递归查询
2. 迭代查询



![image-20211218211842134](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218211842134.png)



**高速缓存：**

![image-20211218212046880](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218212046880.png)

![image-20211218212457565](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218212457565.png)



**练习：**

![image-20211218212911684](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218212911684.png)

![image-20211218213431710](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211218213431710.png)





## 6.3	文件传送协议FTP

![image-20211219104255968](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219104255968.png)





### 6.3.1	基本工作原理



> FTP客户首先对FTP服务器发起TCP连接建立传输控制命令的通道。然后有数据要传输时，FTP服务器告知FTP客户进行TCP连接，建立数据通道
>
> 控制连接在整个会话期间一直打开
>
> 数据连接只有每次文件传输时才建立，传输结束就关闭



**主动模式：**

![image-20211219105137571](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219105137571.png)



**被动模式：**

![image-20211219105730813](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219105730813.png)



**练习：**

![image-20211219110607524](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219110607524.png)

![image-20211219110706110](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219110706110.png)





## 6.4	电子邮件

![image-20211219113828451](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219113828451.png)





**过程：**

![image-20211219114509600](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219114509600.png)





### 6.4.1	SMTP原理

![image-20211219120406803](C:/Users/李天帅/AppData/Roaming/Typora/typora-user-images/image-20211219120406803.png)

![image-20211219120853602](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219120853602.png)

![image-20211219121244551](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219121244551.png)





### 6.4.2	邮件读取协议



![image-20211219121714556](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219121714556.png)

![image-20211219122602198](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219122602198.png)



**练习：**

![image-20211219123045355](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219123045355.png)





![image-20211219123451718](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219123451718.png)



![image-20211219123602505](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219123602505.png)





## 6.5	万维网

![image-20211219181353751](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219181353751.png)

![image-20211219181527656](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219181527656.png)





### 6.5.1	HTTP请求报文格式

![image-20211219182515900](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219182515900.png)



### 6.5.2	HTTP响应报文格式

![image-20211219184058668](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219184058668.png)

![image-20211219184234380](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219184234380.png)



### 6.5.3	Cookie

![image-20211219184644781](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219184644781.png)





### 6.5.4	万维网缓存与代理服务器

![image-20211219190648604](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219190648604.png)



**代理服务器有所请求的对象：**

> 若web缓存的命中率比较高，则大大减少了该网络的通信量，因而可以减少访问因特网的时延

![image-20211219204351819](C:/Users/李天帅/AppData/Roaming/Typora/typora-user-images/image-20211219204351819.png)





**代理服务器没有所请求的对象：**



![image-20211219190846708](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219190846708.png)





> 原始服务器会为每个响应的对象设置一个最后修改时间字段和一个有效日期字段



1. 若代理服务器的有效日期没有过期

   

   

   ![image-20211219192054976](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219192054976.png)

   

2. 若代理服务器的有效日期过期

   **原始服务器根据修改日期与代理服务器的比较：**

   1. 一致

      

      ![image-20211219204435866](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219204435866.png)

   2. 不一致

      > 原始服务器向代理服务器发送文档并更新last-modified、expires

      

      ![image-20211219204536577](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219204536577.png)

   



**练习：**

![image-20211219190136759](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219190136759.png)![image-20211219190420209](https://gitee.com/steadyHeart/drawingBed/raw/master/photos/image-20211219190420209.png)
